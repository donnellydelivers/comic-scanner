<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comic Intake - Interactive Mockup</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0b0f14;
      color: #eaf1ff;
      height: 100vh;
      overflow: hidden;
    }
    
    .phone-frame {
      max-width: 400px;
      height: 100vh;
      margin: 0 auto;
      background: #0b0f14;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    
    /* Top bar */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid #243249;
      border-radius: 16px;
      margin: 10px 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,.4);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #2f78ff, #1a4fb8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 14px;
    }
    
    .title {
      font-weight: 800;
      font-size: 16px;
    }
    
    .sub {
      font-size: 11px;
      color: #9fb0c9;
      margin-top: 2px;
    }
    
    .controls {
      display: flex;
      gap: 8px;
    }
    
    .btn-control {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #243249;
      background: rgba(255,255,255,.04);
      color: #eaf1ff;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all .15s;
    }
    
    .btn-control:active {
      transform: scale(0.95);
    }
    
    .btn-control.primary {
      background: rgba(43,212,111,.18);
      border-color: rgba(43,212,111,.45);
      color: #2bd46f;
    }
    
    .btn-control.pause {
      background: rgba(255,213,74,.18);
      border-color: rgba(255,213,74,.45);
      color: #ffd54a;
    }
    
    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #243249;
      background: rgba(255,255,255,.04);
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .counter {
      font-weight: 700;
      color: #eaf1ff;
    }
    
    /* Main stage */
    .stage {
      flex: 1;
      margin: 0 12px 10px;
      border-radius: 16px;
      border: 1px solid #243249;
      background: #000;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .camera-placeholder {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }
    
    .camera-icon {
      font-size: 48px;
      opacity: 0.3;
    }
    
    .start-screen {
      text-align: center;
      padding: 40px;
    }
    
    .start-screen h2 {
      font-size: 24px;
      margin-bottom: 12px;
    }
    
    .start-screen p {
      color: #9fb0c9;
      margin-bottom: 24px;
      line-height: 1.5;
    }
    
    .btn-start {
      padding: 16px 32px;
      border-radius: 14px;
      background: linear-gradient(135deg, #2f78ff, #1a4fb8);
      color: white;
      font-size: 16px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(47,120,255,.3);
      transition: all .2s;
    }
    
    .btn-start:active {
      transform: scale(0.96);
    }
    
    /* Comic cover mockup */
    .comic-cover {
      width: 280px;
      height: 420px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,.6);
      position: relative;
    }
    
    .comic-cover.spiderman {
      background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
    }
    
    .comic-cover.batman {
      background: linear-gradient(135deg, #4a4a4a 0%, #1a1a1a 100%);
    }
    
    .comic-cover.xmen {
      background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
    }
    
    .comic-header {
      text-align: center;
    }
    
    .comic-publisher {
      font-size: 12px;
      font-weight: 600;
      opacity: 0.9;
    }
    
    .comic-title {
      font-size: 32px;
      font-weight: 900;
      margin: 8px 0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .comic-issue {
      font-size: 48px;
      font-weight: 900;
      text-align: center;
      margin: auto 0;
    }
    
    .comic-footer {
      text-align: center;
      font-size: 11px;
      opacity: 0.8;
    }
    
    /* Result overlay */
    .overlay {
      position: absolute;
      bottom: 12px;
      left: 12px;
      right: 12px;
      background: rgba(16,24,36,.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 20px;
      padding: 16px;
      transform: translateY(120%);
      opacity: 0;
      transition: all .3s ease;
    }
    
    .overlay.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .overlay-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .overlay-info {
      flex: 1;
    }
    
    .overlay-title {
      font-weight: 800;
      font-size: 15px;
      margin-bottom: 4px;
    }
    
    .overlay-meta {
      font-size: 12px;
      color: #9fb0c9;
    }
    
    .badge {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,213,74,.45);
      background: rgba(255,213,74,.12);
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .badge.key {
      border-color: rgba(255,213,74,.6);
      background: rgba(255,213,74,.2);
    }
    
    .badge.goodbook {
      border-color: rgba(100,200,255,.6);
      background: rgba(100,200,255,.2);
    }
    
    .badge.run {
      border-color: rgba(47,120,255,.6);
      background: rgba(47,120,255,.2);
    }
    
    .confidence-bar {
      height: 4px;
      background: rgba(255,255,255,.1);
      border-radius: 2px;
      margin: 12px 0;
      overflow: hidden;
    }
    
    .confidence-fill {
      height: 100%;
      background: rgba(43,212,111,.75);
      transition: width .3s;
    }
    
    .overlay-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 12px;
    }
    
    .btn-action {
      padding: 12px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 13px;
      border: 1px solid #243249;
      cursor: pointer;
      transition: all .15s;
    }
    
    .btn-action:active {
      transform: scale(0.96);
    }
    
    .btn-action.accept {
      background: rgba(43,212,111,.18);
      border-color: rgba(43,212,111,.45);
      color: #2bd46f;
    }
    
    .btn-action.review {
      background: rgba(255,213,74,.18);
      border-color: rgba(255,213,74,.45);
      color: #ffd54a;
    }
    
    /* Bottom nav */
    .bottom-nav {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      padding: 0 12px 12px;
    }
    
    .nav-btn {
      padding: 14px 12px;
      border-radius: 14px;
      border: 1px solid #243249;
      background: rgba(255,255,255,.04);
      text-align: center;
      cursor: pointer;
      transition: all .15s;
    }
    
    .nav-btn:active {
      transform: scale(0.96);
    }
    
    .nav-btn.active {
      background: rgba(47,120,255,.18);
      border-color: rgba(47,120,255,.45);
    }
    
    .nav-icon {
      font-size: 20px;
      margin-bottom: 4px;
    }
    
    .nav-label {
      font-size: 11px;
      font-weight: 700;
    }
    
    .nav-count {
      font-size: 10px;
      color: #9fb0c9;
      margin-top: 2px;
    }
    
    /* List view */
    .list-view {
      display: none;
      flex-direction: column;
      height: 100%;
      padding: 16px;
      overflow-y: auto;
    }
    
    .list-view.active {
      display: flex;
    }
    
    .list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #243249;
    }
    
    .list-title {
      font-size: 20px;
      font-weight: 800;
    }
    
    .list-actions {
      display: flex;
      gap: 8px;
    }
    
    .btn-small {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #243249;
      background: rgba(255,255,255,.04);
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
    }
    
    .btn-small.danger {
      background: rgba(255,77,77,.18);
      border-color: rgba(255,77,77,.45);
      color: #ff4d4d;
    }
    
    .list-item {
      background: rgba(255,255,255,.04);
      border: 1px solid #243249;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .item-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .item-info {
      flex: 1;
    }
    
    .item-title {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 4px;
    }
    
    .item-meta {
      font-size: 11px;
      color: #9fb0c9;
    }
    
    .item-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
    }
    
    .item-badge.key {
      background: rgba(255,213,74,.2);
      color: #ffd54a;
    }
    
    .item-badge.goodbook {
      background: rgba(100,200,255,.2);
      color: #64c8ff;
    }
    
    .item-badge.run {
      background: rgba(47,120,255,.2);
      color: #2f78ff;
    }
    
    .item-delete {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid rgba(255,77,77,.3);
      background: rgba(255,77,77,.1);
      color: #ff4d4d;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all .15s;
    }
    
    .item-delete:active {
      transform: scale(0.9);
      background: rgba(255,77,77,.2);
    }
    
    /* Hidden class */
    .hidden {
      display: none !important;
    }
    
    /* Scanning indicator */
    .scanning-indicator {
      position: absolute;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.7);
      backdrop-filter: blur(10px);
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.2);
      font-size: 12px;
      font-weight: 700;
      display: none;
      align-items: center;
      gap: 8px;
    }
    
    .scanning-indicator.active {
      display: flex;
    }
    
    .pulse {
      width: 10px;
      height: 10px;
      background: #2bd46f;
      border-radius: 50%;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }
  </style>
</head>
<body>
  <div class="phone-frame">
    <!-- Top Bar -->
    <div class="topbar">
      <div class="brand">
        <div class="logo">CI</div>
        <div>
          <div class="title">Comic Intake</div>
          <div class="sub" id="statusText">Ready to scan</div>
        </div>
      </div>
      <div class="controls">
        <button class="btn-control" id="settingsBtn" style="font-size: 18px;">‚öôÔ∏è</button>
        <button class="btn-control hidden" id="pauseBtn">‚è∏ Pause</button>
        <button class="btn-control primary hidden" id="startScanBtn">‚ñ∂ Scan</button>
      </div>
    </div>

    <!-- Main Stage -->
    <div class="stage" id="stage">
      <!-- Start Screen -->
      <div class="start-screen" id="startScreen">
        <div class="camera-icon">üì∏</div>
        <h2>Ready to Scan</h2>
        <p>Point your camera at comic book covers and let AI identify keys, runs, and values automatically.</p>
        <button class="btn-start" id="startBtn">‚ñ∂ Start Scanning</button>
      </div>

      <!-- Camera View (hidden initially) -->
      <div class="camera-placeholder hidden" id="cameraView">
        <video id="video" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
        
        <div class="scanning-indicator" id="scanIndicator">
          <div class="pulse"></div>
          <span>Analyzing...</span>
        </div>
        
        <!-- Zoom controls -->
        <div class="zoom-controls" style="position: absolute; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 8px; background: rgba(0,0,0,0.6); padding: 8px; border-radius: 12px;">
          <button class="zoom-btn" id="zoomIn" style="width: 40px; height: 40px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 20px; cursor: pointer;">+</button>
          <div id="zoomLevel" style="color: white; font-size: 11px; text-align: center;">100%</div>
          <button class="zoom-btn" id="zoomOut" style="width: 40px; height: 40px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 20px; cursor: pointer;">‚àí</button>
        </div>
      </div>
      
      <!-- Reviews List View -->
      <div class="list-view" id="reviewsView">
        <div class="list-header">
          <div class="list-title">üü® Reviews (4)</div>
          <div class="list-actions">
            <button class="btn-small" onclick="toggleSelectAll('reviews')">Select All</button>
            <button class="btn-small danger" onclick="deleteSelected('reviews')">Delete</button>
          </div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="reviews">
          <div class="item-info">
            <div class="item-title">Fantastic Four #??</div>
            <div class="item-meta">Marvel ‚Ä¢ Low confidence ‚Ä¢ Needs review</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge" style="background: rgba(255,77,77,.2); color: #ff4d4d;">LOW</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="reviews">
          <div class="item-info">
            <div class="item-title">Detective Comics #527</div>
            <div class="item-meta">DC ‚Ä¢ 1983 ‚Ä¢ Confidence: 68%</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge" style="background: rgba(255,213,74,.2); color: #ffd54a;">REVIEW</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="reviews">
          <div class="item-info">
            <div class="item-title">Unknown Series #12</div>
            <div class="item-meta">Publisher unclear ‚Ä¢ Needs identification</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge" style="background: rgba(255,77,77,.2); color: #ff4d4d;">LOW</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="reviews">
          <div class="item-info">
            <div class="item-title">Green Lantern #76</div>
            <div class="item-meta">DC ‚Ä¢ 1970 ‚Ä¢ Possible key? Confidence: 72%</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge" style="background: rgba(255,213,74,.2); color: #ffd54a;">REVIEW</div>
        </div>
      </div>
      
      <!-- Good Books List View -->
      <div class="list-view" id="goodBooksView">
        <div class="list-header">
          <div class="list-title">üíé Good Books (0)</div>
          <div class="list-actions">
            <button class="btn-small" onclick="toggleSelectAll('goodbooks')">Select All</button>
            <button class="btn-small danger" onclick="deleteSelected('goodbooks')">Delete</button>
          </div>
        </div>
        
        <div style="text-align: center; padding: 60px 20px; color: #9fb0c9;">
          <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">üíé</div>
          <p>No good books yet</p>
          <p style="font-size: 11px; margin-top: 8px;">Solid singles worth listing individually</p>
        </div>
      </div>
      
      <!-- Keys List View -->
      <div class="list-view" id="keysView">
        <div class="list-header">
          <div class="list-title">üîë Keys (6)</div>
          <div class="list-actions">
            <button class="btn-small" onclick="toggleSelectAll('keys')">Select All</button>
            <button class="btn-small danger" onclick="deleteSelected('keys')">Delete</button>
          </div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="keys">
          <div class="item-info">
            <div class="item-title">Amazing Spider-Man #300</div>
            <div class="item-meta">Marvel ‚Ä¢ 1988 ‚Ä¢ 1st Venom</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge key">KEY</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="keys">
          <div class="item-info">
            <div class="item-title">Incredible Hulk #181</div>
            <div class="item-meta">Marvel ‚Ä¢ 1974 ‚Ä¢ 1st Wolverine</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge key">KEY</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="keys">
          <div class="item-info">
            <div class="item-title">Batman #1</div>
            <div class="item-meta">DC ‚Ä¢ 2011 ‚Ä¢ New 52 begins</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge key">KEY</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="keys">
          <div class="item-info">
            <div class="item-title">New Mutants #98</div>
            <div class="item-meta">Marvel ‚Ä¢ 1991 ‚Ä¢ 1st Deadpool</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge key">KEY</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="keys">
          <div class="item-info">
            <div class="item-title">Teenage Mutant Ninja Turtles #1</div>
            <div class="item-meta">Mirage ‚Ä¢ 1984 ‚Ä¢ 1st TMNT</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge key">KEY</div>
        </div>
        
        <div class="list-item">
          <input type="checkbox" class="item-checkbox" data-list="keys">
          <div class="item-info">
            <div class="item-title">Giant-Size X-Men #1</div>
            <div class="item-meta">Marvel ‚Ä¢ 1975 ‚Ä¢ New X-Men team</div>
          </div>
          <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
          <div class="item-badge key">KEY</div>
        </div>
      </div>
      

      <!-- Result Overlay -->
      <div class="overlay" id="overlay">
        <div class="overlay-header">
          <div class="overlay-info">
            <div class="overlay-title" id="overlayTitle">MARVEL ‚Ä¢ Amazing Spider-Man</div>
            <div class="overlay-meta" id="overlayMeta">Issue #300 ‚Ä¢ 1988 ‚Ä¢ VF/NM</div>
          </div>
          <div class="badge key" id="overlayBadge">
            ‚≠ê <strong>KEY</strong>
          </div>
        </div>
        
        <!-- Pricing Info -->
        <div id="pricingInfo" style="background: rgba(255,255,255,.04); border-radius: 12px; padding: 12px; margin-bottom: 12px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 11px;">
            <div>
              <div style="color: #9fb0c9; margin-bottom: 4px;">üí∞ Profit (after fees)</div>
              <div style="font-weight: 700; font-size: 15px; color: #4ade80;" id="profitRange">$9-$15</div>
              <div style="color: #9fb0c9; font-size: 10px; margin-top: 2px;" id="soldInfo">Sold $18-$25</div>
            </div>
            <div>
              <div style="color: #9fb0c9; margin-bottom: 4px;">üè∑Ô∏è Listed</div>
              <div style="font-weight: 700; font-size: 13px;" id="listedRange">$20-$30</div>
              <div style="color: #9fb0c9; font-size: 10px; margin-top: 2px;" id="listedCount">24 active</div>
            </div>
          </div>
        </div>
        
        <div class="confidence-bar">
          <div class="confidence-fill" id="confidenceFill" style="width: 92%"></div>
        </div>
        
        <div style="font-size: 11px; color: #9fb0c9; margin-bottom: 8px;" id="overlayNotes">
          1st appearance Venom ‚Ä¢ Database match
        </div>
        
        <div class="overlay-actions">
          <button class="btn-action accept" id="acceptBtn">‚úì Add to Keys</button>
          <button class="btn-action review" id="reviewBtn">? Review</button>
        </div>
      </div>
    </div>


    <!-- Settings Modal -->
    <div id="settingsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; padding: 20px;">
      <div style="max-width: 400px; margin: 40px auto; background: #1a2332; border-radius: 16px; padding: 24px;">
        <h2 style="margin-bottom: 20px; font-size: 20px;">Settings</h2>
        
        <label style="display: block; margin-bottom: 8px; font-size: 13px; color: #9fb0c9;">Gemini API Key</label>
        <input type="password" id="apiKeyInput" placeholder="Enter your Gemini API key" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #243249; background: rgba(255,255,255,0.05); color: white; font-size: 14px; margin-bottom: 16px;">
        
        <div style="font-size: 11px; color: #9fb0c9; margin-bottom: 20px;">
          Get your free API key at <a href="https://aistudio.google.com/apikey" target="_blank" style="color: #64c8ff;">aistudio.google.com/apikey</a>
        </div>
        
        <div style="display: flex; gap: 12px;">
          <button id="cancelSettings" style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #243249; background: rgba(255,255,255,0.05); color: white; cursor: pointer;">Cancel</button>
          <button id="saveSettings" style="flex: 1; padding: 12px; border-radius: 8px; border: none; background: #2f78ff; color: white; font-weight: 600; cursor: pointer;">Save</button>
        </div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="nav-btn active" id="navReviews" onclick="showView('reviews')">
        <div class="nav-icon">üü®</div>
        <div class="nav-label">Reviews</div>
        <div class="nav-count" id="reviewsCount">0</div>
      </div>
      <div class="nav-btn" id="navGoodBooks" onclick="showView('goodbooks')">
        <div class="nav-icon">üíé</div>
        <div class="nav-label">Good Books</div>
        <div class="nav-count" id="goodBooksCount">0</div>
      </div>
      <div class="nav-btn" id="navKeys" onclick="showView('keys')">
        <div class="nav-icon">üîë</div>
        <div class="nav-label">Keys</div>
        <div class="nav-count" id="keysCount">0</div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================================
    // CONFIGURATION
    // ============================================================================
    
    let GEMINI_API_KEY = localStorage.getItem('gemini_api_key') || '';
    let isScanning = false;
    let isPaused = false;
    let scanCount = 0;
    
    // ============================================================================
    // GEMINI VISION + EBAY PRICING INTEGRATION
    // ============================================================================
    
    async function analyzeWithGemini(base64Image) {
      const prompt = `You are identifying a comic book from a cover photo and researching its market value.

**Step 1: Identify the comic**
- Publisher (DC, Marvel, Image, etc.)
- Series name
- Issue number
- Approximate year
- Condition estimate (Poor/Good/VG/Fine/VF/NM based on visible wear)

**Step 2: Search eBay for pricing**
Search eBay for this exact comic in similar condition:
- SOLD listings (last 90 days, actual sales)
- ACTIVE listings (current asking prices)

**Step 3: Calculate profit after fees**
For sold prices, calculate net profit after:
- eBay fees: 18.75% (13.25% final value + 2% promoted + 3.5% payment processing)
- Shipping cost: $5 (USPS First Class)
- Formula: Sold price - (Sold price √ó 0.1875) - $5 = Net profit

**Step 4: Return JSON**
{
  "publisher": "string or Unknown",
  "series": "string or null",
  "issue_number": "string or null",
  "approx_year": "string (e.g. '1987') or null",
  "condition": "Poor | Good | VG | Fine | VF | NM",
  "sold_low": number or null,
  "sold_high": number or null,
  "sold_count": number (how many sales found),
  "profit_low": number or null (net profit from sold_low after fees),
  "profit_high": number or null (net profit from sold_high after fees),
  "listed_low": number or null,
  "listed_high": number or null,
  "listed_count": number (how many active listings),
  "standout": "yes | no | maybe",
  "confidence": 0.0-1.0,
  "notes": "key issue reason, or pricing notes, or identification issues"
}

**Example calculation:**
Sold for $20 ‚Üí Profit = $20 - ($20 √ó 0.1875) - $5 = $20 - $3.75 - $5 = $11.25

**Rules:**
- Do NOT guess issue numbers
- If eBay search finds no results, set all price/profit fields to null
- Standout = yes for: #1 issues, first appearances, milestone issues (50,100,300,etc), deaths, weddings
- Include condition-adjusted pricing when possible
- If cover is unreadable due to glare/bags/cropping, lower confidence and set fields to null
- Calculate profit for BOTH low and high sold prices

Return ONLY valid JSON, no markdown formatting.`;

      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [
                { text: prompt },
                {
                  inline_data: {
                    mime_type: 'image/jpeg',
                    data: base64Image
                  }
                }
              ]
            }],
            generationConfig: {
              temperature: 0.4,
              topK: 32,
              topP: 0.95,
              maxOutputTokens: 1024,
            }
          })
        }
      );

      if (!response.ok) {
        throw new Error(`Gemini API error: ${response.status}`);
      }

      const data = await response.json();
      const text = data.candidates[0].content.parts[0].text;
      
      // Extract JSON from markdown code blocks if present
      const jsonMatch = text.match(/```json\s*([\s\S]*?)\s*```/) || text.match(/\{[\s\S]*\}/);
      const jsonText = jsonMatch ? (jsonMatch[1] || jsonMatch[0]) : text;
      
      return JSON.parse(jsonText);
    }
    
    // ============================================================================
    // KEY DETECTION SYSTEM
    // ============================================================================
    
    function normalizeForLookup(publisher, series, issue) {
      if (!publisher || !series || !issue) return null;
      
      const pub = publisher.toUpperCase().trim();
      const ser = series.toUpperCase()
        .replace(/[^\w\s]/g, '')
        .replace(/\s+/g, ' ')
        .trim();
      const iss = String(issue).replace(/[^\d]/g, '');
      
      return `${pub}::${ser}::${iss}`;
    }

    function checkKeyDatabase(result) {
      const lookupKey = normalizeForLookup(result.publisher, result.series, result.issue_number);
      if (!lookupKey) return null;
      
      const keyData = COMIC_KEYS_DB[lookupKey];
      if (keyData) {
        return {
          reason: keyData.r,
          importance: keyData.i
        };
      }
      return null;
    }
    
    // ============================================================================
    // ROUTING LOGIC (3-TIER SYSTEM - PROFIT-BASED)
    // ============================================================================
    
    function determineRoute(result) {
      // Check database first
      const keyMatch = checkKeyDatabase(result);
      
      // TIER 1: KEYS - Database match with high importance OR high profit
      if (keyMatch && keyMatch.importance >= 8) {
        result.tier = 'keys';
        result.tierReason = keyMatch.reason;
        return 'keys';
      }
      
      // Use average profit after fees (calculated by Gemini)
      const avgProfit = (result.profit_low && result.profit_high) 
        ? (result.profit_low + result.profit_high) / 2 
        : null;
      
      if (avgProfit && avgProfit >= 40) {
        result.tier = 'keys';
        result.tierReason = `High profit: $${Math.round(avgProfit)} after fees`;
        return 'keys';
      }
      
      // TIER 2: GOOD BOOKS - Meets profit floor ($8+)
      if (avgProfit && avgProfit >= 8 && avgProfit < 40) {
        result.tier = 'goodbooks';
        result.tierReason = `Profitable: $${Math.round(avgProfit)} profit after fees`;
        return 'goodbooks';
      }
      
      // Also good books: Issue #1, pre-1980, standouts (even without pricing data)
      const issueNum = parseInt(String(result.issue_number || '').replace(/[^\d]/g, ''));
      if (issueNum === 1 || issueNum === 0) {
        result.tier = 'goodbooks';
        result.tierReason = `Issue #${issueNum}`;
        return 'goodbooks';
      }
      
      if (result.approx_year) {
        const yearMatch = result.approx_year.match(/(\d{4})/);
        const year = yearMatch ? parseInt(yearMatch[1]) : null;
        if (year && year < 1980) {
          result.tier = 'goodbooks';
          result.tierReason = `Pre-1980 (${year})`;
          return 'goodbooks';
        }
      }
      
      if (result.standout === 'yes' && result.confidence > 0.75) {
        result.tier = 'goodbooks';
        result.tierReason = result.notes || 'Standout issue';
        return 'goodbooks';
      }
      
      // TIER 3: REVIEWS - Low confidence OR below profit floor
      if (result.confidence < 0.70 || !result.series || !result.issue_number) {
        result.tier = 'reviews';
        result.tierReason = 'Low confidence - needs review';
        return 'reviews';
      }
      
      // Default: Below profit floor or no data goes to reviews
      result.tier = 'reviews';
      result.tierReason = avgProfit ? `Below profit floor: ~$${Math.round(avgProfit)}` : 'No pricing data';
      return 'reviews';
    }
    
    // ============================================================================
    // UI HELPER FUNCTIONS
    // ============================================================================
    
    function formatPriceRange(low, high) {
      if (!low && !high) return 'No data';
      if (!high) return `$${Math.round(low)}`;
      if (!low) return `$${Math.round(high)}`;
      if (low === high) return `$${Math.round(low)}`;
      return `$${Math.round(low)}-$${Math.round(high)}`;
    }
    
    function showToast(message) {
      // Simple toast notification
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.9);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 10000;
        font-size: 14px;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
    
    // Real scanning and camera below
    let currentComicIndex = 0;
    
    // Settings modal
    document.getElementById('settingsBtn').addEventListener('click', () => {
      document.getElementById('apiKeyInput').value = GEMINI_API_KEY;
      document.getElementById('settingsModal').style.display = 'block';
    });
    
    document.getElementById('cancelSettings').addEventListener('click', () => {
      document.getElementById('settingsModal').style.display = 'none';
    });
    
    document.getElementById('saveSettings').addEventListener('click', () => {
      GEMINI_API_KEY = document.getElementById('apiKeyInput').value.trim();
      localStorage.setItem('gemini_api_key', GEMINI_API_KEY);
      document.getElementById('settingsModal').style.display = 'none';
      showToast('‚úì API key saved');
    });
    
    // Start button on main screen
    document.getElementById('startBtn').addEventListener('click', () => {
      startScanning();
    });
    
    // Start scan button in top bar
    document.getElementById('startScanBtn').addEventListener('click', () => {
      startScanning();
    });
    
    // ============================================================================
    // CAMERA & CAPTURE
    // ============================================================================
    
    let video = null;
    let stream = null;
    let currentZoom = 1.0;
    let isCapturing = false;
    let currentResult = null; // Store current scan result
    
    async function initCamera() {
      try {
        video = document.getElementById('video');
        
        stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'environment',
            width: { ideal: 1920 },
            height: { ideal: 1080 },
            aspectRatio: { ideal: 16/9 }
          }
        });
        
        video.srcObject = stream;
        video.style.transform = `scale(${currentZoom})`;
        
        // Zoom controls
        document.getElementById('zoomIn').addEventListener('click', () => {
          currentZoom = Math.min(currentZoom + 0.1, 1.5);
          video.style.transform = `scale(${currentZoom})`;
          document.getElementById('zoomLevel').textContent = `${Math.round(currentZoom * 100)}%`;
        });
        
        document.getElementById('zoomOut').addEventListener('click', () => {
          currentZoom = Math.max(currentZoom - 0.1, 0.5);
          video.style.transform = `scale(${currentZoom})`;
          document.getElementById('zoomLevel').textContent = `${Math.round(currentZoom * 100)}%`;
        });
        
        return true;
      } catch (err) {
        console.error('Camera error:', err);
        showToast('‚ö†Ô∏è Camera access denied');
        return false;
      }
    }
    
    async function captureAndAnalyze() {
      if (!GEMINI_API_KEY) {
        showToast('‚ö†Ô∏è Set your Gemini API key in Settings first');
        return;
      }
      
      if (isCapturing) return;
      
      isCapturing = true;
      document.getElementById('scanIndicator').classList.add('active');
      
      try {
        // Capture frame from video
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);
        
        const imageData = canvas.toDataURL('image/jpeg', 0.9);
        const base64 = imageData.split(',')[1];
        
        // Analyze with Gemini (includes eBay pricing)
        const result = await analyzeWithGemini(base64);
        
        // Determine routing tier
        determineRoute(result);
        
        // Store result
        currentResult = result;
        
        // Show result overlay
        document.getElementById('scanIndicator').classList.remove('active');
        showResult(result);
        
      } catch (err) {
        console.error('Analysis error:', err);
        showToast('‚ö†Ô∏è Analysis failed: ' + err.message);
        document.getElementById('scanIndicator').classList.remove('active');
        isCapturing = false;
      }
    }
    
    // Auto-capture on tap (when scanning is active)
    document.getElementById('video').addEventListener('click', () => {
      if (isScanning && !isPaused && !isCapturing) {
        captureAndAnalyze();
      }
    });
    
    function startScanning() {
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('cameraView').classList.remove('hidden');
      document.getElementById('reviewsView').classList.remove('active');
      document.getElementById('goodBooksView').classList.remove('active');
      document.getElementById('keysView').classList.remove('active');
       // runs removed
      document.getElementById('pauseBtn').classList.remove('hidden');
      document.getElementById('startScanBtn').classList.add('hidden');
      document.getElementById('statusText').textContent = 'Tap screen to scan';
      
      // Deactivate all nav buttons when scanning
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      
      isScanning = true;
      isPaused = false;
      
      // Initialize camera if not already
      if (!video || !stream) {
        initCamera();
      }
    }
    
    // Pause button
    document.getElementById('pauseBtn').addEventListener('click', () => {
      isPaused = !isPaused;
      const btn = document.getElementById('pauseBtn');
      if (isPaused) {
        btn.textContent = '‚ñ∂ Resume';
        btn.classList.remove('pause');
        btn.classList.add('primary');
        document.getElementById('statusText').textContent = 'Paused';
      } else {
        btn.textContent = '‚è∏ Pause';
        btn.classList.remove('primary');
        btn.classList.add('pause');
        document.getElementById('statusText').textContent = 'Tap screen to scan';
      }
    });
    
    // Accept button - adds item to appropriate list
    document.getElementById('acceptBtn').addEventListener('click', () => {
      if (!currentResult) return;
      
      const tier = currentResult.tier || 'reviews';
      const listId = tier === 'keys' ? 'keysView' : 
                     tier === 'goodbooks' ? 'goodBooksView' : 'reviewsView';
      
      // Create list item
      const listContainer = document.getElementById(listId);
      const listHeader = listContainer.querySelector('.list-header');
      
      // Remove empty state if present
      const emptyState = listContainer.querySelector('[style*="text-align: center"]');
      if (emptyState && emptyState.textContent.includes('No ')) {
        emptyState.remove();
      }
      
      const newItem = document.createElement('div');
      newItem.className = 'list-item';
      
      const avgProfit = (currentResult.profit_low && currentResult.profit_high) 
        ? Math.round((currentResult.profit_low + currentResult.profit_high) / 2)
        : null;
      
      const priceInfo = avgProfit ? ` ‚Ä¢ $${avgProfit} profit` : '';
      
      newItem.innerHTML = `
        <input type="checkbox" class="item-checkbox" data-list="${tier}">
        <div class="item-info">
          <div class="item-title">${currentResult.series || 'Unknown'} #${currentResult.issue_number || '?'}</div>
          <div class="item-meta">${currentResult.publisher || 'Unknown'} ‚Ä¢ ${currentResult.approx_year || '?'}${priceInfo}</div>
        </div>
        <button class="item-delete" onclick="deleteItem(this)" title="Delete">üóë</button>
        <div class="item-badge ${tier === 'keys' ? 'key' : tier === 'goodbooks' ? 'goodbook' : ''}">
          ${tier === 'keys' ? 'KEY' : tier === 'goodbooks' ? 'GOOD' : 'REVIEW'}
        </div>
      `;
      
      // Insert after header
      if (listHeader.nextSibling) {
        listContainer.insertBefore(newItem, listHeader.nextSibling);
      } else {
        listContainer.appendChild(newItem);
      }
      
      updateCounts();
      scanCount++;
      
      document.getElementById('overlay').classList.remove('show');
      isCapturing = false;
      currentResult = null;
      
      const tierName = tier === 'keys' ? 'Keys' : tier === 'goodbooks' ? 'Good Books' : 'Reviews';
      showToast(`‚úì Added to ${tierName}`);
    });
    
    // Review button
    document.getElementById('reviewBtn').addEventListener('click', () => {
      document.getElementById('overlay').classList.remove('show');
      setTimeout(() => {
        if (isScanning && !isPaused) {
          simulateScan();
        }
      }, 1000);
    });
    
    // Simulate scanning
    function simulateScan() {
      if (!isScanning || isPaused) return;
      
      document.getElementById('scanIndicator').classList.add('active');
      
      // Show comic cover
      setTimeout(() => {
        const comic = dummyComics[currentComicIndex % dummyComics.length];
        currentComicIndex++;
        
        document.getElementById('comicDisplay').innerHTML = `
          <div class="comic-cover ${comic.color}">
            <div class="comic-header">
              <div class="comic-publisher">${comic.publisher}</div>
              <div class="comic-title">${comic.title}</div>
            </div>
            <div class="comic-issue">#${comic.issue}</div>
            <div class="comic-footer">${comic.year}</div>
          </div>
        `;
        
        document.getElementById('scanIndicator').classList.remove('active');
        
        // Show result overlay after brief delay
        setTimeout(() => {
          showResult(comic);
        }, 1500);
      }, 2000);
    }
    
    function showResult(result) {
      // Title and meta
      document.getElementById('overlayTitle').textContent = 
        `${result.publisher || 'Unknown'} ‚Ä¢ ${result.series || 'Unknown Series'}`;
      document.getElementById('overlayMeta').textContent = 
        `Issue #${result.issue_number || '?'} ‚Ä¢ ${result.approx_year || 'Unknown'} ‚Ä¢ ${result.condition || 'Unknown'}`;
      
      // Pricing info - show profit prominently
      if (result.profit_low || result.profit_high) {
        const profitRange = formatPriceRange(result.profit_low, result.profit_high);
        document.getElementById('profitRange').textContent = profitRange;
        document.getElementById('profitRange').style.color = 
          ((result.profit_low + result.profit_high) / 2) >= 8 ? '#4ade80' : '#fbbf24';
        
        // Show sold prices as secondary info
        const soldRange = formatPriceRange(result.sold_low, result.sold_high);
        document.getElementById('soldInfo').textContent = `Sold ${soldRange} (${result.sold_count || 0})`;
      } else {
        document.getElementById('profitRange').textContent = 'No data';
        document.getElementById('profitRange').style.color = '#9fb0c9';
        document.getElementById('soldInfo').textContent = '';
      }
      
      if (result.listed_low || result.listed_high) {
        document.getElementById('listedRange').textContent = formatPriceRange(result.listed_low, result.listed_high);
        document.getElementById('listedCount').textContent = `${result.listed_count || 0} active`;
      } else {
        document.getElementById('listedRange').textContent = 'No data';
        document.getElementById('listedCount').textContent = '';
      }
      
      // Notes and confidence
      document.getElementById('overlayNotes').textContent = 
        result.tierReason || result.notes || 'Analysis complete';
      document.getElementById('confidenceFill').style.width = 
        `${(result.confidence || 0) * 100}%`;
      
      // Badge and button based on tier
      const badge = document.getElementById('overlayBadge');
      const acceptBtn = document.getElementById('acceptBtn');
      
      const tier = result.tier || 'reviews';
      
      if (tier === 'keys') {
        badge.innerHTML = 'üîë <strong>KEY</strong>';
        badge.className = 'badge key';
        acceptBtn.textContent = '‚úì Add to Keys';
        acceptBtn.dataset.tier = 'keys';
      } else if (tier === 'goodbooks') {
        badge.innerHTML = 'üíé <strong>GOOD</strong>';
        badge.className = 'badge goodbook';
        acceptBtn.textContent = '‚úì Add to Good Books';
        acceptBtn.dataset.tier = 'goodbooks';
      } else {
        badge.innerHTML = 'üü® <strong>REVIEW</strong>';
        badge.className = 'badge';
        acceptBtn.textContent = '? Add to Reviews';
        acceptBtn.dataset.tier = 'reviews';
      }
      
      document.getElementById('overlay').classList.add('show');
    }
    
    function showView(view) {
      // Stop scanning if active
      if (isScanning) {
        isScanning = false;
        document.getElementById('pauseBtn').classList.add('hidden');
        document.getElementById('startScanBtn').classList.remove('hidden');
        document.getElementById('statusText').textContent = 'View mode';
        document.getElementById('overlay').classList.remove('show');
      }
      
      currentView = view;
      
      // Hide ALL views first (including start screen)
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('cameraView').classList.add('hidden');
      
      // Remove active from all list views
      document.getElementById('reviewsView').classList.remove('active');
      document.getElementById('goodBooksView').classList.remove('active');
      document.getElementById('keysView').classList.remove('active');
       // runs removed
      
      // Update nav
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected view and make scan button available
      document.getElementById('startScanBtn').classList.remove('hidden');
      
      // Show selected view with .active class
      if (view === 'reviews') {
        document.getElementById('navReviews').classList.add('active');
        document.getElementById('reviewsView').classList.add('active');
        document.getElementById('statusText').textContent = 'Viewing Reviews';
      } else if (view === 'goodbooks') {
        document.getElementById('navGoodBooks').classList.add('active');
        document.getElementById('goodBooksView').classList.add('active');
        document.getElementById('statusText').textContent = 'Viewing Good Books';
      } else if (view === 'keys') {
        document.getElementById('navKeys').classList.add('active');
        document.getElementById('keysView').classList.add('active');
        document.getElementById('statusText').textContent = 'Viewing Keys';
      }
    }
    
    function toggleSelectAll(list) {
      const checkboxes = document.querySelectorAll(`input[data-list="${list}"]`);
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      checkboxes.forEach(cb => cb.checked = !allChecked);
    }
    
    function deleteSelected(list) {
      const checkboxes = document.querySelectorAll(`input[data-list="${list}"]:checked`);
      if (checkboxes.length === 0) {
        alert('No items selected');
        return;
      }
      
      if (confirm(`Delete ${checkboxes.length} selected item(s)?`)) {
        checkboxes.forEach(cb => {
          cb.closest('.list-item').remove();
        });
        
        // Update counts
        updateCounts();
      }
    }
    
    function deleteItem(button) {
      if (confirm('Delete this item?')) {
        button.closest('.list-item').remove();
        updateCounts();
      }
    }
    
    function updateCounts() {
      const reviewsCount = document.querySelectorAll('#reviewsView .list-item').length;
      const goodBooksCount = document.querySelectorAll('#goodBooksView .list-item').length;
      const keysCount = document.querySelectorAll('#keysView .list-item').length;
      document.getElementById('reviewsCount').textContent = reviewsCount;
      document.getElementById('goodBooksCount').textContent = goodBooksCount;
      document.getElementById('keysCount').textContent = keysCount;
    }
    
    // Initialize - show start screen, hide lists
    document.getElementById('reviewsView').classList.remove('active');
    document.getElementById('goodBooksView').classList.remove('active');
    document.getElementById('keysView').classList.remove('active');
     // runs removed
    document.getElementById('navReviews').classList.remove('active');
  </script>
</body>
</html>
